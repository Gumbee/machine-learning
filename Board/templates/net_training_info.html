{% extends "layout.html" %}
{% block title %}Neural Networks{% endblock %}

{% block breadcrumb %}
    <a href="/nets" class="breadcrumb">Neural Networks</a>
    <a href="/nets/{{net_id}}" class="breadcrumb">Network: {{ neural_net['network_info']['name'] }}</a>
    <a href="#" class="breadcrumb">Session: {{ session_id }}</a>
{% endblock %}


{% block content %}
{% if neural_net['training']['entries']|length != neural_net['training']['entries_no_anom']|length and neural_net['training']['entries_no_anom']|length > 0  %}
<div style="width: 50%;float: left;height: 50px;position: relative;">
    <div style="position: absolute;bottom: 0;">
        <span class="title">{{neural_net['network_info']['name']}}</span><span class="small-title">{{ net_id }}</span>
    </div>
</div>
<div style="width: 50%;float: left;height: 50px;position: relative;">
    <span class="sub-title" style="position: absolute;bottom: 0;padding-left: 10px;">Graph without anomalies</span>
</div>
<div style="margin-top:0px;width: 50%;height: 300px;float:left;display: block;">
    <div class="ct-chart" id="chart_with_anomalies"></div>
</div>
{% else %}
<div style="width: 100%;position: relative;">
    <div>
        <span class="title">{{neural_net['network_info']['name']}}</span><span class="small-title">{{ net_id }}</span>
    </div>
</div>
<div style="margin-top:0px;width: 100%;height: 300px;float:left;display: block;">
    <div class="ct-chart" id="chart_with_anomalies"></div>
</div>
{% endif %}
{% if neural_net['training']['entries']|length != neural_net['training']['entries_no_anom']|length  and neural_net['training']['entries_no_anom']|length > 0 %}
<div style="margin-top:0px;width: 50%;float:left;display: block;">
    <div class="ct-chart" id="chart_no_anomalies"></div>
</div>
{% endif %}

<div class="sub-title" style="padding-bottom: 10px;">Accuracies</div>
<!-- Accuracies -->
<div style="margin-top:0px;width: 100%;float:left;display: block;">
    <div class="ct-chart ct-tracker" id="chart_tracker"></div>
</div>

{% endblock %}


{% block scripts %}
<script>
    var True = true;
    var False = false;
    var data = {{ neural_net|safe }};
    console.log(data);

    var values = data['training']['costs'];
    var x_axis = data['training']['entries'];

    var values_no_anom = data['training']['costs_no_anom'];
    var x_axis_no_anom = data['training']['entries_no_anom'];

    document.addEventListener('DOMContentLoaded',function(){
        var options = {
            fullWidth: true,
            height: '300px',
            chartPadding: {
                right: 40,
                left: 0
            },
            axisX: {
                labelInterpolationFnc: function (value, index) {
                    return index % (data['training']['entry_num']/10) === 0 ? value : null;
                },
                showGrid: false
            },
            axisY: {
                labelInterpolationFnc: function (value) {
                    return Math.round(value * 100) / 100;
                }
            }
        };

        new Chartist.Line('#chart_with_anomalies', {
            labels: x_axis,
            series: [
                        values
                    ]
        }, options);

        if(x_axis_no_anom.length != x_axis.length) {
            new Chartist.Line('#chart_no_anomalies', {
                labels: x_axis_no_anom,
                series: [
                    values_no_anom
                ]
            }, options);
        }

        var options_tracker = {
            fullWidth: true,
            height: '300px',
            chartPadding: {
                right: 40,
                left: 0
            },
            axisX: {
                labelInterpolationFnc: function (value, index) {
                    return index % (data['training']['entry_num']/20) === 0 ? value : null;
                },
                showGrid: false
            },
            axisY: {
                labelInterpolationFnc: function (value) {
                    return Math.round(value * 100) / 100;
                }
            },
            plugins: [
                Chartist.plugins.legend({
                    legendNames: [
                        {% for tracker in neural_net['training']['accuracies'] %}
                            data['training']['accuracies_names'][{{ loop.index0 }}],
                        {% endfor %}
                    ],
                })
            ]
        };

        new Chartist.Line('#chart_tracker', {
            labels: x_axis,
            series: [
                    {% for tracker in neural_net['training']['accuracies'] %}
                        data['training']['accuracies'][{{ loop.index0 }}],
                    {% endfor %}
                    ]
        }, options_tracker);

    });


</script>
{% endblock %}